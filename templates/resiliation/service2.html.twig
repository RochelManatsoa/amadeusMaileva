{% extends 'base.html.twig' %}

{% block title %}
	Résiliation
	{{category}}
{% endblock %}


{% block body %}
    <style type="text/css">
		{#:root{
			/*--bs-bleu-clair: rgba(0, 201, 255, 0.9294117647);*/
			--bs-green-clair: #00ca00;
			/*--bs-bleu-fonse: rgba(29, 29, 94, 0.8);*/
			--bs-green-fonse: #005f25;
			--bs-night-blue: #00032f;
			--bs-green-white: #e7e7e7;
			--bs-rest-height: calc(100vh - 226px);
		}
		.text-comfortaa{
			font-family : 'Comfortaa' , sans-serif ;
		}
		.navbar-collapse .nav-link{
			color: var(--bs-night-blue);
			font-weight: bold;
		}
		.container-step-title{
			width: 260px;
			border-radius: 5px;
			padding: 25px 30px;
			display: grid;
			height: calc(100% - 135px);
			align-items: center;
			position: fixed;
		}
		.step-title li{
			margin: 25px 0;
			font-size: 20px;
			font-weight: 500;
			text-align: center;
			color: var(--bs-green-white);
			padding: 10px 0;
			background: var(--bs-green-fonse);
			background: -webkit-linear-gradient(to right, var(--bs-green-clair), var(--bs-green-fonse));
			background: linear-gradient(to right, var(--bs-green-clair), var(--bs-green-fonse)); 
			position: relative;
		}
		.step-title li::before{
			content: '';
			position: absolute;
			transform: translateX(-100%);
			width: 30px;
			height: 50px;
			left: 0;
			top: 0;
			background: linear-gradient(to right, transparent, var(--bs-green-clair));
		}
		.step-title li::after{
			content: '';
			position: absolute;
			width: 60px;
			height: 50px;
			right: -60px;
			top: 0;
			border-left: 30px solid var(--bs-green-fonse);
			border-top: 25px solid transparent;
			border-bottom: 25px solid transparent;
			border-right: 30px solid transparent;
		}
		.container-form{
			margin-left: 260px;
			padding: 0 30px;
		}
		.legend{
			font-size: 25px;
		}
		.border-green, .card, .form-control, .form-select{
			border: solid 2px var(--bs-green-fonse);
			border-radius: 5px;
		}
		.bg-gradient-green{
			/* background: #000000; fallback for old browsers */
			background: -webkit-linear-gradient(45deg, #0f9b0f, var(--bs-night-blue));  /* Chrome 10-25, Safari 5.1-6 */
			background: linear-gradient(45deg, #0f9b0f,var(--bs-night-blue)); /* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
		}
		.text-green-white{
			color: var(--bs-green-white);
		}
		.container-form,
		.min-height-body{
			min-height: var(--bs-rest-height);
		}
		.text-night-blue{
			color: var(--bs-night-blue);
		}
		.shadow{
			box-shadow: 0 0.5rem 1rem #00032f !important;
		}#}
    </style>

	<div class="container-fluid pt-5 pb-3 min-vh-100 bg-marbre-blanc step-form">
		<div>
			
			<div class="container-step-title d-md-block d-none">
				<ul class="list-unstyled step-title w-100">
					<li class="">
						<a href="#step-form1">
							Services à résilier
						</a>
					</li>
					<li class="not-yet">
						<a href="#step-form2">
							Modèle de lettre
						</a>
					</li>
					<li class="not-yet">
						<a href="#step-form3">
							Coordonnées
						</a>
					</li>
					<li class="not-yet">
						<a href="#step-form4">
							Récapitulatif
						</a>
					</li>
				</ul>
			</div>
			<div class="container-step-form">
				<h3 class="text-center mt-5 text-night-blue text-comfortaa fw-bold">Lettre de résiliation - {{category}}</h3>
				{{ form_start(form, {'attr': {'id': 'example-basic'}}) }}

					<div id="step-form1" class="border-green mx-3 my-5 p-3 bg-gradient-green min-height-body shadow-night-blue current" data-element="step-form1" index="1">
						{#<h3>A qui addresser la lettre</h3>#}
						<legend class="text-green-white">{{ form_label(form.service) }}</legend>
						<div class="card border-green my-3 bg-transparent text-green-white">
							<div class="card-body">
								<h4 class="card-title">Sélectionnez une société depuis notre annuaire</h4>
								<p class="card-text">Plus besoin de chercher l'adresse de résiliation, nous l'avons trouvé pour vous ! Sélectionnez une société pour l'ajouter à votre lettre.</p>
								<div class="d-flex justify-content-center" id="societe_a_resillier">
									{% for service in services %}
										<button class="button btn-gradient-green mx-2" id="{{'service' ~ service.id}}" data-service="{{service.slug}}">{{service.name}}</button>
									{% endfor %}
								</div>
							</div>
						</div>
						<div class="card border-green my-3 bg-transparent text-green-white">
							<div id="service-address" data-services="{{ dataServices | json_encode()}}" class="card-body">
								<h4 class="card-title">Adresse de résiliation de votre destinataire</h4>
								{{ form_row(form.service.name, { 'attr' : { 'data-service' : 'name'}})}}
								{{ form_row(form.service.address, { 'attr' : { 'data-service' : 'adress'}})}}
								{{ form_row(form.service.complement, { 'attr' : { 'data-service' : 'complement'}})}}

								<div class="row">
									<div class="col-sm">{{ form_row(form.service.zipCode, { 'attr' : { 'data-service' : 'zipCode'}})}}</div>
									<div class="col-sm">{{ form_row(form.service.city, { 'attr' : { 'data-service' : 'city'}})}}</div>
								</div>
							</div>
						</div>
					</div>

					<div id="step-form2" class="border-green mx-3  my-5 p-3 bg-gradient-green min-height-body shadow-night-blue d-none" data-element="step-form2" index="2">
						<legend class="text-green-white">{{ form_label(form.service) }}</legend>
						<div class="ancientitulaire card my-3 border-0 bg-transparent text-green-white">
							<div class="card-body">
								{{ form_row(form.number)}}
								{{ form_row(form.type, {'attr': {'data-letters':  letters | json_encode() 
								}})}}


								{{ form_row(form.description)}}
							</div>
						</div>
					</div>

					<div id="step-form3" class="border-green mx-3  my-5 p-3 bg-gradient-green min-height-body shadow-night-blue d-none" data-element="step-form3" index="3">
						<legend class="text-green-white">Mes coordonnées</legend>
						<div class="ancientitulaire card my-3 border-0 bg-transparent text-green-white">
							<div class="card-body">
								<div class="row">
									<div class="col-sm">{{ form_row(form.client.firstName)}}</div>
									<div class="col-sm">{{ form_row(form.client.lastName)}}</div>
								</div>
								{{ form_row(form.client.mobile)}}
								{{ form_row(form.client.address.name)}}
								{{ form_row(form.client.address.complement)}}
								<div class="row">
									<div class="col-sm">{{ form_row(form.client.address.zipCode)}}</div>
									<div class="col-sm">{{ form_row(form.client.address.city)}}</div>
								</div>
							</div>
						</div>
					</div>

					<div id="step-form4" class="border-green mx-3 my-5 p-3 bg-gradient-green min-height-body shadow-night-blue d-none" recap data-element="step-form4" index="4">
						<legend class="text-green-white">Récapitulatif des informations liées à la demande</legend>
						{#<div id="resum"></div>#}
						<div class="mt-3">
							<table id="resum"></table>
						</div>
						<div style="display:none;">
							{{form_rest(form)}}
						</div>
					</div>

					<div class="text-end">
						<ul class="list-inline">
							<li class="list-inline-item d-none">
								<a href="#previous" class="button btn-gradient-green-blue" id="previous-button" data-form="previous">
									Précedent
								</a>
							</li>
							<li class="list-inline-item">
								<a href="#next" class="button btn-night-blue" id="next-button"  data-form="next">
									Suivant
								</a>
							</li>
							<li class="list-inline-item d-none">
								<button class="button btn-night-blue" data-form="submit" 
								id="finish-button" type="submit">
									Générer
								</button>
							</li>
						</ul>
					<div>

				{{ form_end(form) }}

			</div>
		</div>
    </div>
{% endblock %}

{% block jsFooter %}
	<script src="{{asset('assets/js/essaie.js')}}"></script>
	<script>

		$(function(){
			
			choices = document.getElementById('societe_a_resillier').querySelectorAll('button');
			
			done = [];
			
			data = $('#resiliation_form_type').data('letters');

			for (choice of choices){
				choice.onclick = function(){
					ref = $(this).data('service');
					addressService =  $('#service-address').data('services')[ref];
					$('input#resiliation_form_service_name').val(addressService.name)
					$('input#resiliation_form_service_address').val(addressService.address)
					$('input#resiliation_form_service_complement').val(addressService.complement)
					$('input#resiliation_form_service_zipCode').val(addressService.zipCode)
					$('input#resiliation_form_service_city').val(addressService.city)
				}
			}
			
			$('#resiliation_form_description').html(data[1].content);

			$('#resiliation_form_type').on('change', function (e) {
				var Value = $(".ancientitulaire").find(":selected").val();
				$('#resiliation_form_description').text(data[Value].content)
			})

			document.getElementById('previous-button').onclick = function(){
				previousStep(document.querySelector('[data-element].current'));
			}
			document.getElementById('next-button').onclick = function(){
				nextStep(document.querySelector('[data-element].current'));
			}
		})
	</script>
{% endblock %}
